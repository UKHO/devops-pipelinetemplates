
parameters:
- name: WorkingDirectory
  default: $(System.DefaultWorkingDirectory)
- name: Exclusions
  default: azure-network-no-public-ingress,azure-network-no-public-egress

steps:
- checkout: self
- bash: mkdir ${{parameters.WorkingDirectory}}/TrivyReport
- bash: docker run --rm -v ${{parameters.WorkingDirectory}}:/src aquasec/trivy
  displayName: 'Run Trivy Vulnerability Scan'
- bash: docker run --rm -v ${{parameters.WorkingDirectory}}:/src aquasec/trivy
  displayName: 'Generate Trivy JUnit Report'
- task: PublishTestResults@2
  displayName: Publish Trivy JUnit Test Results
  inputs:
    testResultsFiles: '${{parameters.WorkingDirectory}}/TrivyReport/trivy-results.xml'
    testResultsFormat: 'JUnit'
