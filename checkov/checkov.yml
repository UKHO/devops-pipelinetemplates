parameters:
  - name: scanDirectory
    type: string
  - name: outputDirectory
    type: string
    default: $(System.DefaultWorkingDirectory)
steps:
  - checkout: self
  - bash: docker pull bridgecrew/checkov
    displayName: Pull Checkov Container
  - bash: docker run --volume ${{ parameters.scanDirectory }}:/workingDir --workdir /workingDir bridgecrew/checkov --directory /workingDir --output junitxml --output cli --output-file-path ${{ parameters.outputDirectory }}
    displayName: Check Terraform
  - task: PublishTestResults@2
    condition: always()
    inputs:
      testResultsFiles: '${{ parameters.outputDirectory }}/results_junitxml.xml'
      failTaskOnFailedTests: true
      publishRunAttachments: true
