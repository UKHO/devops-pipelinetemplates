parameters:
- name: BuildId
  default: $(Build.BuildId)
- name: CommitId
  default: $(Build.SourceVersion)

steps:
  - checkout: self
    persistCredentials: true

  - task: PowerShell@2
    displayName: "Create and publish tag"
    inputs:
      targetType: 'inline'
      script: |
          $timestamp = Get-Date -format 'dd-MM-yyyy-hh.mm.ss'
          $tagName = ${{parameters.BuildId}} + "-" + $timestamp

          Write-Host "Creating tag $tagName"
          git tag $tagName ${{parameters.CommitId}}
          Write-Host "Tag created"

          Write-Host "Pushing Tag $tagName"
          git push origin $tagName
          Write-Host "Tag pushed"